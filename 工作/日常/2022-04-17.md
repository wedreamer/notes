# 重构 identity service 中遇到的一些问题

- 很多函数都会多一个 orgId, 是否有必要

## 重构 identity service 中检查流程

- 对照前后数据库之间字段的差异, 保证返回的数据符合之前的结构以及内容
    + 数据库实体名称改变
    + 删除
    + 增加
    + 默认值
    + 单表分多表
    + 多表合一表
> 参考: 数据库设计, 旧 proto, 迁移脚本, 代码中的内容（可以找到迁移时忽略的一些细节）

- 之前 proto 生成的对应实体是否有必要侵入到 domain 甚至 dao 层❓
- 对比每个 service 方法
    + service 的方法定义完全不变
    + 内部数据逻辑可以改变, 业务逻辑不能改变

- 检查 dao 层的数据字段相关变更, 持久化名称是否与迁移脚本一致
- identify service 数据入口映射到现有数据的逻辑
- identify service 数据出口来自现有数据结构的组合
- 内部逻辑
    + 拿不定一定要加 TODO
    + 变更比较大的地方可以加上 warning
    + 多讨论, 降低信息差, 争取更准确

- 代码书写
    + 数据出入的映射逻辑可以单独抽离成一个方法, 大多数时间这个方法是很多方法公用的
    + 数据库实体定义最好使用指针, 保证可以区分默认值和空值
    + 空指针一定要处理
    + 错误分层 -> servcie -> domain -> repo
    + 注意软删除

- 测试
    + 跑通

## 相关错误抽象
### service
- 输入数据转换错误
- 输出数据转换错误
### domain
### repo

## 缓存
- 如何缓存
- 缓存失效处理
- 避免缓存大量失效
